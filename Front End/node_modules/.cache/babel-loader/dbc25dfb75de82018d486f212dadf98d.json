{"remainingRequest":"/Users/leonliang/Developer/Operation_KnowledgeGraph/Front End/node_modules/babel-loader/lib/index.js!/Users/leonliang/Developer/Operation_KnowledgeGraph/Front End/node_modules/eslint-loader/index.js??ref--13-0!/Users/leonliang/Developer/Operation_KnowledgeGraph/Front End/src/assets/dataV.js","dependencies":[{"path":"/Users/leonliang/Developer/Operation_KnowledgeGraph/Front End/src/assets/dataV.js","mtime":1539663469084},{"path":"/Users/leonliang/Developer/Operation_KnowledgeGraph/Front End/node_modules/cache-loader/dist/cjs.js","mtime":1539668827796},{"path":"/Users/leonliang/Developer/Operation_KnowledgeGraph/Front End/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/leonliang/Developer/Operation_KnowledgeGraph/Front End/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.map\";\n\nfunction showData2(nodes, links) {\n  var colorMap = new Map();\n  colorMap.set(\"\\\"System\\\"\", 'aqua');\n  colorMap.set(\"\\\"Service\\\"\", 'lightskyblue');\n  colorMap.set(\"\\\"Component\\\"\", 'deepskyblue');\n  colorMap.set(\"\\\"Container\\\"\", 'royalblue');\n  colorMap.set(\"\\\"Container Resource\\\"\", 'blue');\n  colorMap.set(\"\\\"VM\\\"\", 'navy');\n  colorMap.set(\"\\\"Fail-stop\\\"\", 'red');\n  colorMap.set(\"\\\"ADR\\\"\", 'lime');\n  colorMap.set(\"\\\"Test Case\\\"\", 'gold');\n  var N = JSON.stringify(nodes);\n  var E = JSON.stringify(links);\n  localStorage.setItem('nodes', N);\n  localStorage.setItem('links', E);\n  var width = 1000;\n  var height = 500;\n  var has_graph = false;\n  var svg = d3.select('svg'),\n      width = +svg.attr('width'),\n      height = +svg.attr('height');\n  svg.selectAll('*').remove();\n  console.log(d3.forceManyBody()); // 通过布局来转换数据，然后进行绘制\n\n  var simulation = d3.forceSimulation(nodes).force('link', d3.forceLink(links).id(function (d) {\n    return d.id;\n  })).force('charge', d3.forceManyBody()) // 创建多体力\n  .force('center', d3.forceCenter(width / 2, height / 2));\n  d3.select('input[type = range]').on('input', inputted);\n  simulation.nodes(nodes) // 设置力模拟的节点\n  .on('tick', ticked);\n  simulation.force('link').strength(0.06) // 添加或移除力\n  .links(links); // 设置连接数组\n\n  var color = d3.scaleOrdinal(d3.schemeCategory20); // 绘制\n\n  var svg_links = svg.selectAll('line').data(links).enter().append('line').style('stroke', '#ccc').style('stroke-width', 1).call(d3.zoom() // 创建缩放行为\n  .scaleExtent([-5, 2]) // 设置缩放范围\n  );\n  var svg_nodes = svg.selectAll('circle').data(nodes).enter().append('circle').attr('cx', function (d) {\n    return d.x;\n  }).attr('cy', function (d) {\n    return d.y;\n  }).attr('r', '16').attr('fill', function (d) {\n    return colorMap.get(d.type);\n  }).attr('stroke', 'gray').style('stroke-width', 2).on('dblclick', click).on('click', showDetail).on('mouseover', onHover).on('mouseout', moveOut).call(d3.drag().on('start', dragstarted).on('drag', dragged).on('end', dragended));\n  var svg_texts = svg.selectAll('text').data(nodes).enter().append('text').style('fill', 'white').attr('dx', 1).attr('dy', 1).attr('text-anchor', 'middle').attr('font-size', 8).text(function (d) {\n    return d.name.substring(0, 8);\n  });\n\n  function dragstarted(d) {\n    if (!d3.event.active) simulation.alphaTarget(0.3).restart(); // 设置目标α\n\n    d.fx = d.x;\n    d.fy = d.y;\n  }\n\n  function dragged(d) {\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n\n  function dragended(d) {\n    if (!d3.event.active) simulation.alphaTarget(0);\n    d.fx = null;\n    d.fy = null;\n  }\n\n  function inputted() {\n    simulation.force('link').strength(+this.value);\n    simulation.alpha(1).restart();\n  }\n\n  function ticked() {\n    svg_links.attr('x1', function (d) {\n      return d.source.x;\n    }).attr('y1', function (d) {\n      return d.source.y;\n    }).attr('x2', function (d) {\n      return d.target.x;\n    }).attr('y2', function (d) {\n      return d.target.y;\n    });\n    svg_nodes.attr('cx', function (d) {\n      return d.x;\n    }).attr('cy', function (d) {\n      return d.y;\n    });\n    svg_texts.attr('x', function (d) {\n      return d.x;\n    }).attr('y', function (d) {\n      return d.y;\n    });\n  }\n}\n\nfunction click(d) {\n  updateData(d.name);\n}\n\nfunction showDetail(d) {\n  document.getElementById('this_id').value = \"id: \" + d.id;\n  document.getElementById('this_name').value = \"name: \" + d.name;\n  document.getElementById('this_type').value = \"type: \" + d.type;\n  document.getElementById('this_layer').value = \"layer: \" + d.layer;\n  document.getElementById('this_performance').value = \"performance: \" + d.performance;\n}\n\nfunction onHover(d) {\n  d3.select(this).style('stroke-width', 6);\n  d3.select(this).style('r', 18);\n  document.getElementById('id').innerHTML = \"id: \" + d.id;\n  document.getElementById('name').innerHTML = \"name: \" + d.name;\n  document.getElementById('type').innerHTML = \"type: \" + d.type;\n  document.getElementById('layer').innerHTML = \"layer: \" + d.layer;\n}\n\nfunction moveOut(d) {\n  d3.select(this).style('stroke-width', 2);\n  d3.select(this).style('r', 16);\n}\n\nfunction updateData(name) {\n  document.getElementById('loading').style.display = 'inline';\n  var temp;\n  name = name.replace(\"\\\"\", \"\").replace(\"\\\"\", \"\");\n  $.ajax({\n    type: 'post',\n    async: true,\n    crossDomain: true,\n    url: 'http://localhost:8088/bbs/api/getNeighbors',\n    beforeSend: function beforeSend(xhr) {\n      xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n    },\n    data: {\n      name: name\n    },\n    success: function success(res) {\n      temp = res;\n      var newLinks = temp.links;\n      var newNodes = temp.nodes;\n      var oldNodes = JSON.parse(localStorage.getItem('nodes'));\n      var oldLinks = JSON.parse(localStorage.getItem('links'));\n      var nodes = removeRepeat(newNodes, oldNodes, 'n');\n      var links = removeRepeat(newLinks, oldLinks, 'l');\n      console.log(nodes);\n      console.log(links);\n      showData2(nodes, links);\n      document.getElementById('loading').style.display = 'none';\n    },\n    error: function error(res) {\n      console.log('A Something wrong!');\n    }\n  });\n}\n\nfunction removeRepeat(x, y, type) {\n  if (type === 'n') {\n    for (var i = 0; i < x.length; i++) {\n      for (var j = 0; j < y.length; j++) {\n        if (x[i].name === y[j].name) {\n          x.splice(i--, 1);\n          break;\n        }\n      }\n    }\n  } else {\n    for (var i = 0; i < x.length; i++) {\n      for (var j = 0; j < y.length; j++) {\n        if (x[i].source === y[j].source && x[i].target === y[j].target && x[i].type === y[j].type) {\n          x.splice(i--, 1);\n          break;\n        }\n      }\n    }\n  }\n\n  var array = x.concat(y);\n  return array;\n}\n\nexport { showData2, removeRepeat };",{"version":3,"sources":["/Users/leonliang/Developer/Operation_KnowledgeGraph/Front End/src/assets/dataV.js"],"names":["showData2","nodes","links","colorMap","Map","set","N","JSON","stringify","E","localStorage","setItem","width","height","has_graph","svg","d3","select","attr","selectAll","remove","console","log","forceManyBody","simulation","forceSimulation","force","forceLink","id","d","forceCenter","on","inputted","ticked","strength","color","scaleOrdinal","schemeCategory20","svg_links","data","enter","append","style","call","zoom","scaleExtent","svg_nodes","x","y","get","type","click","showDetail","onHover","moveOut","drag","dragstarted","dragged","dragended","svg_texts","text","name","substring","event","active","alphaTarget","restart","fx","fy","value","alpha","source","target","updateData","document","getElementById","layer","performance","innerHTML","display","temp","replace","$","ajax","async","crossDomain","url","beforeSend","xhr","setRequestHeader","success","res","newLinks","newNodes","oldNodes","parse","getItem","oldLinks","removeRepeat","error","i","length","j","splice","array","concat"],"mappings":"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","sourcesContent":["function showData2 (nodes, links) {\n    var colorMap = new Map();\n    colorMap.set(\"\\\"System\\\"\",'aqua');\n    colorMap.set(\"\\\"Service\\\"\",'lightskyblue');\n    colorMap.set(\"\\\"Component\\\"\",'deepskyblue');\n    colorMap.set(\"\\\"Container\\\"\",'royalblue');\n    colorMap.set(\"\\\"Container Resource\\\"\",'blue');\n    colorMap.set(\"\\\"VM\\\"\",'navy');\n    colorMap.set(\"\\\"Fail-stop\\\"\",'red');\n    colorMap.set(\"\\\"ADR\\\"\",'lime');\n    colorMap.set(\"\\\"Test Case\\\"\",'gold');\n    var N = JSON.stringify(nodes)\n    var E = JSON.stringify(links)\n    localStorage.setItem('nodes', N)\n    localStorage.setItem('links', E)\n    var width = 1000\n    var height = 500\n    var has_graph = false\n    var svg = d3.select('svg'),\n        width = +svg.attr('width'),\n        height = +svg.attr('height')\n    svg.selectAll('*').remove()\n    console.log(d3.forceManyBody())\n    // 通过布局来转换数据，然后进行绘制\n    var simulation = d3.forceSimulation(nodes)\n        .force('link', d3.forceLink(links).id(function (d) { return d.id }))\n        .force('charge', d3.forceManyBody())// 创建多体力\n        .force('center', d3.forceCenter(width / 2, height / 2))\n\n    d3.select('input[type = range]')\n        .on('input', inputted)\n\n    simulation\n        .nodes(nodes)// 设置力模拟的节点\n        .on('tick', ticked)\n\n    simulation.force('link').strength(0.06)// 添加或移除力\n        .links(links)// 设置连接数组\n    var color = d3.scaleOrdinal(d3.schemeCategory20)\n    // 绘制\n    var svg_links = svg.selectAll('line')\n        .data(links)\n        .enter()\n        .append('line')\n        .style('stroke', '#ccc')\n        .style('stroke-width', 1)\n        .call(d3.zoom()// 创建缩放行为\n            .scaleExtent([-5, 2])// 设置缩放范围\n        )\n\n    var svg_nodes = svg.selectAll('circle')\n        .data(nodes)\n        .enter()\n        .append('circle')\n        .attr('cx', function (d) { return d.x })\n        .attr('cy', function (d) { return d.y })\n        .attr('r', '16')\n        .attr('fill', function (d) { return colorMap.get(d.type) })\n        .attr('stroke', 'gray')\n        .style('stroke-width', 2)\n        .on('dblclick', click)\n        .on('click', showDetail)\n        .on('mouseover', onHover)\n        .on('mouseout', moveOut)\n        .call(d3.drag()\n            .on('start', dragstarted)\n            .on('drag', dragged)\n            .on('end', dragended))\n\n    var svg_texts = svg.selectAll('text')\n        .data(nodes)\n        .enter()\n        .append('text')\n        .style('fill', 'white')\n        .attr('dx', 1)\n        .attr('dy', 1)\n        .attr('text-anchor', 'middle')\n        .attr('font-size', 8)\n        .text(function (d) {\n            return d.name.substring(0,8)\n        })\n\n    function dragstarted (d) {\n        if (!d3.event.active) simulation.alphaTarget(0.3).restart()// 设置目标α\n        d.fx = d.x\n        d.fy = d.y\n    }\n\n    function dragged (d) {\n        d.fx = d3.event.x\n        d.fy = d3.event.y\n    }\n\n    function dragended (d) {\n        if (!d3.event.active) simulation.alphaTarget(0)\n        d.fx = null\n        d.fy = null\n    }\n\n    function inputted () {\n        simulation.force('link').strength(+this.value)\n        simulation.alpha(1).restart();\n    }\n\n    function ticked () {\n        svg_links.attr('x1', function (d) { return d.source.x })\n            .attr('y1', function (d) { return d.source.y })\n            .attr('x2', function (d) { return d.target.x })\n            .attr('y2', function (d) { return d.target.y })\n\n        svg_nodes.attr('cx', function (d) { return d.x })\n            .attr('cy', function (d) { return d.y })\n\n        svg_texts.attr('x', function (d) { return d.x })\n            .attr('y', function (d) { return d.y })\n\n    }\n}\n\nfunction click (d) {\n    updateData(d.name)\n}\n\nfunction showDetail(d) {\n    document.getElementById('this_id').value = \"id: \"+d.id;\n    document.getElementById('this_name').value = \"name: \"+d.name;\n    document.getElementById('this_type').value = \"type: \"+d.type;\n    document.getElementById('this_layer').value = \"layer: \"+d.layer;\n    document.getElementById('this_performance').value = \"performance: \"+d.performance;\n}\n\nfunction onHover(d) {\n    d3.select(this).style('stroke-width',6)\n    d3.select(this).style('r',18)\n    document.getElementById('id').innerHTML = \"id: \"+d.id;\n    document.getElementById('name').innerHTML = \"name: \"+d.name;\n    document.getElementById('type').innerHTML = \"type: \"+d.type;\n    document.getElementById('layer').innerHTML = \"layer: \"+d.layer;\n}\n\nfunction moveOut(d) {\n    d3.select(this).style('stroke-width',2)\n    d3.select(this).style('r',16)\n}\n\nfunction updateData (name) {\n    document.getElementById('loading').style.display = 'inline'\n    var temp\n    name = name.replace(\"\\\"\",\"\").replace(\"\\\"\",\"\")\n    $.ajax({\n        type: 'post',\n        async: true,\n        crossDomain: true,\n        url: 'http://localhost:8088/bbs/api/getNeighbors',\n        beforeSend: function (xhr) {\n            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')\n        },\n        data: {name:name},\n        success: function (res) {\n            temp = res\n            var newLinks = temp.links\n            var newNodes = temp.nodes\n            var oldNodes = JSON.parse(localStorage.getItem('nodes'))\n            var oldLinks = JSON.parse(localStorage.getItem('links'))\n            var nodes = removeRepeat(newNodes, oldNodes, 'n')\n            var links = removeRepeat(newLinks, oldLinks, 'l')\n            console.log(nodes)\n            console.log(links)\n            showData2(nodes, links)\n            document.getElementById('loading').style.display = 'none'\n        },\n        error: function (res) {\n            console.log('A Something wrong!')\n        }\n    })\n}\n\nfunction removeRepeat (x, y, type) {\n    if (type === 'n') {\n        for (var i = 0; i < x.length; i++) {\n            for (var j = 0; j < y.length; j++) {\n                if (x[i].name === y[j].name) {\n                    x.splice(i--, 1)\n                    break\n                }\n            }\n        }\n    } else {\n        for (var i = 0; i < x.length; i++) {\n            for (var j = 0; j < y.length; j++) {\n                if (x[i].source === y[j].source && x[i].target === y[j].target && x[i].type === y[j].type) {\n                    x.splice(i--, 1)\n                    break\n                }\n            }\n        }\n    }\n    var array = x.concat(y)\n    return array\n}\n\nexport { showData2, removeRepeat }"]}]}